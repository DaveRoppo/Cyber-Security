# Analyzing Redline-Stealer Malware Traffic with Security Onion

## About
A Malware traffic analysis exercise from a pcap posted on Malware-Traffic-Analysis.net in July 2023 by Brad Duncan (Unit 42) featuring Redline Stealer malware.

Link to Brad Duncan's exercise archives: https://www.malware-traffic-analysis.net/

## Tools Used
- Security Onion Console
- Network Miner
- Wireshark
- Mitre ATT&CK
- Virus Total
- URLHaus
- MalwareBazaar
- Suricata
- SHA256

### MITRE ATT&CK Redline Stealer & G1004 Threat Group References
![](img/group.png)

## Incident Report

### Executive summary

On 2023-07-10 at 22:39 UTC, a Windows computer used by the user "rwalters" was infected with Redline-Stealer, a Windows-based malware categorized as an information stealer. It is designed to infiltrate systems covertly and exfiltrate sensitive information, including login credentials, cryptocurrency wallets, personal data, and other valuable information to remote command and control (C2) servers operated by threat actors. 

Following the infection of the victim host, an data exfiltration attempt was made to a remote C2 server including the folloiwng:

- Running Processes
- Hardware Specifications
- Files on the victim's desktop
- Files in the victim's Documents folder
- Login credentials from various web browsers
- User data for various  web browsers
- Data for several cryptocurrency wallets and the associated browser plugins 
- API keys

Due to the attempted data exfiltration, rwalters was instructed to change login credentials for all platforms, applications, and services included in the exfiltration attempt.
  
### Victim details

- Victim’s IP address: 10.7.10[.]47
- Victim’s MAC address: 80:86:5b:ab:1e:c4
- Victim’s Windows host name: DESKTOP-9PEA63H
- Victim’s Windows user account name: rwalters
###### Hosts tab in Network Miner displaying the victim's details 
![](img/nm-host.png)

### Indicators of compromise (IoCs)
#### IP Addresses, Ports, Domain names, URLs
- hxxp://623start[.]site/?status=start&av=
- hxxp://623start[.]site/?status=install
###### Security Onion Console TCP Stream displaying the antivirus being reported to the malicious domain 
![](img/psasci.png)
![](img/pshex.png)
###### Get request reporting the victim's antivirus status to the malicious domain
![](img/get-623.png)
![](img/get-6232.png)
###### VirusTotal query for the malicious domain
![](img/vt-623.png)
###### VirusTotal query for the malicious IP
![](img/vt195.png)
###### MITRE ATT&CK Tactic Associated With Malicious Activity 
![](img/c2.png)
- hxxp://guiatelefonos[.]com/data/czx.jpg
- hxxps://guiatelefonos[.]com/data/czx.jpg
###### Security Onion Console displaying certificate information for the malicious domain
![](img/dash-cert.png)
###### Security Onion Console displaying the get request for the malicious file
![](img/dash-get.png)
###### URLHaus query for the malicious domain
![](img/haus-gui.png)
###### VirusToal query for the malicious IP
![](img/vt92.png)
###### VirusTotal query for the malicious domain
![](img/vtgui.png)
###### MITRE ATT&CK Tactic Associated With Malicious Activity 
![](img/exe.png)
- tcp://194.26.135[.]119:12432/
###### Security Onion Console displaying connections to the Redline C2 domain
![](img/dash-beacon.png)
###### Wireshark displaying the connection to the Redline C2 domain
![](img/ws-beacon.png)
###### Security Onion Console TCP Stream displaying the attempted data exfiltration
![](img/exfil.png)
###### VirusToal query for the malicious IP
![](img/vt194.png)
###### MITRE ATT&CK Tactic Associated With Malicious Activity 
![](img/ex.png)
#### Files
- SHA256 hash: 3c42b93801f02696487de64bb623f81cf7baf73a379a46e1459ca19ae7dc2454
- File size: 348,160 bytes
- File location: hxxps://guiatelefonos[.]com/data/czx.jpg
- File description: Windows executable file for RedLine Stealer
###### Network Miner diplaying the malicious file
![](img/nm-files.png)
###### Security Onion Console displaying the get request for the malicious file
![](img/jpg.png)
###### MalwareBazaar entry for the malicious file
![](img/mal.png)
#### Suricata Alerts
###### Overview of Suricata alerts that fired 
![](img/alerts.png)
###### Suricata Alert: Redline Stealer
![](img/al-any.png)
###### Suricata Alert: net.tcp connection activity
![](img/al-net.png)
###### Suricata Alert: Redline C2
![](img/al-out.png)
###### Suricata Alert: Powershell User-Agent
![](img/al-ps.png)
###### Suricata Alert: Redline Stealer C2 Response
![](img/al-resp.png) 

## Local Area Network (LAN) Details 
- LAN segment range: 10.7.10[.]0/24 (10.7.10[.]1 through 10.7.10[.]255)
- Domain: coolweathercoat[.]com
- Domain controller IP address: 10.7.10[.]9
- Domain controller hostname: WIN-S3WT6LGQFVX
- LAN segment gateway: 10.7.10[.]1
- LAN segment broadcast address: 10.7.10[.]255

## Exercise Questions

#### What is the date and time in UTC the infection started? 07-10-23 22:39 UTC
#### What is the IP address of the infected Windows client? 10.7.10[.]47
#### What is the MAC address of the infected Windows client? 80:86:5b:ab:1e:c4
#### What is the hostname of the infected Windows client? DESKTOP-9PEA63H
#### What is the user account name from the infected Windows host? rwalters
#### What type of information did this RedLine Stealer try to steal? *See Below*
###### TCP Stream displaying exfil of victim's directory data and data from various cryptocurrency wallets
![](img/exfil-stream.png)
###### TCP Stream displaying exfil of a screenshot of the victim's desktop
![](img/exfil-stream2.png)
###### TCP Stream displaying victim's running processes and captured login credentials
![](img/exfil-stream3.png)
###### Editing the hex values of the extracted file to reveal the .png screenshot taken by the threat actor
![](img/hex.png)
###### MITRE ATT&CK Tactic Associated With Malicious Activity 
![](img/coll.png)

#### Security Onion Console Dashboards
###### Security Onion Console Dashboard: PCAP Overview
![](img/dash-overview.png)
###### Security Onion Console Dashboard: Connections Overview
![](img/dash-conn.png)
###### Security Onion Console Dashboard: HTTP Overview
![](img/dash-http.png)

## Acknowledgements
For more information on this pcap, see [Crossing the Line: Unit 42 Wireshark Quiz for RedLine Stealer](https://unit42.paloaltonetworks.com/wireshark-quiz-redline-stealer/)
